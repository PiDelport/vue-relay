!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["vue-relay"]=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=require("fbjs/lib/invariant"),i={NETWORK_ONLY:"NETWORK_ONLY",STORE_THEN_NETWORK:"STORE_THEN_NETWORK"},o=function(){function e(){t(this,e),this._selectionReferences=[]}return n(e,[{key:"fetch",value:function(e){var t=this,n=e.cacheConfig,r=e.dataFrom,a=void 0===r?"NETWORK_ONLY":r,i=e.environment,o=e.onDataChange,s=e.operation,l=i.unstable_internal.createOperationSelector,c=[],u=!1,h=void 0;this._disposeRequest(),this._fetchOptions=e,"STORE_THEN_NETWORK"===a&&i.check(s.root)&&(this._cacheReference=i.retain(s.root),this._onQueryDataAvailable({notifyFirstResult:!1}));var p=i.execute({operation:s,cacheConfig:n}).finally(function(){t._pendingRequest=null,t._disposeCacheReference()}).subscribe({next:function(e){var n=l(s.node,e.variables,e.operation);c.push(i.retain(n.root)),t._disposeCacheReference(),t._onQueryDataAvailable({notifyFirstResult:u})},error:function(e){t._selectionReferences=t._selectionReferences.concat(c),u?o({error:e}):h=e},complete:function(){t._disposeSelectionReferences(),t._selectionReferences=c},unsubscribe:function(){t._selectionReferences=t._selectionReferences.concat(c)}});if(this._pendingRequest={dispose:function(){p.unsubscribe()}},u=!0,h)throw h;return this._snapshot}},{key:"retry",value:function(){return a(this._fetchOptions,"ReactRelayQueryFetcher: `retry` should be called after having called `fetch`"),this.fetch(this._fetchOptions)}},{key:"dispose",value:function(){this._disposeRequest(),this._disposeSelectionReferences()}},{key:"_disposeCacheReference",value:function(){this._cacheReference&&(this._cacheReference.dispose(),this._cacheReference=null)}},{key:"_disposeRequest",value:function(){this._snapshot=null,this._disposeCacheReference(),this._pendingRequest&&this._pendingRequest.dispose(),this._rootSubscription&&(this._rootSubscription.dispose(),this._rootSubscription=null)}},{key:"_disposeSelectionReferences",value:function(){this._selectionReferences.forEach(function(e){return e.dispose()}),this._selectionReferences=[]}},{key:"_onQueryDataAvailable",value:function(e){var t=e.notifyFirstResult;a(this._fetchOptions,"ReactRelayQueryFetcher: `_onQueryDataAvailable` should have been called after having called `fetch`");var n=this._fetchOptions,r=n.environment,i=n.onDataChange,o=n.operation;this._snapshot||(this._snapshot=r.lookup(o.fragment),this._rootSubscription=r.subscribe(this._snapshot,function(e){return i({snapshot:e})}),this._snapshot&&t&&i({snapshot:this._snapshot}))}}]),e}();o.DataFrom=i;var s=require("fbjs/lib/areEqual"),l=function(e,t,n,r){return{error:e,props:t?t.data:null,retry:function(){var t=n.retry();t?r.handleDataChange({snapshot:t}):e&&r.handleRetryAfterError(e)}}},c=function(e,t,n){var r=e.environment,a=e.query,i=e.variables;if(!a)return t.dispose(),{relayContextEnvironment:r,relayContextVariables:i,renderProps:{error:null,props:{},retry:null}};var o=r,s=o.unstable_internal,c=(0,s.createOperationSelector)((0,s.getRequest)(a),i);try{var u=t.fetch({cacheConfig:e.cacheConfig,dataFrom:e.dataFrom,environment:o,onDataChange:n.handleDataChange,operation:c});return u?{relayContextEnvironment:r,relayContextVariables:c.variables,renderProps:l(null,u,t,n)}:{relayContextEnvironment:r,relayContextVariables:c.variables,renderProps:{error:null,props:null,retry:null}}}catch(e){return{relayContextEnvironment:r,relayContextVariables:c.variables,renderProps:l(e,null,t,n)}}},u={name:"relay-query-renderer",props:{cacheConfig:{},dataFrom:{},environment:{required:!0},query:{},variables:{type:Object,default:function(){return{}}}},data:function(){var e=this,t={handleDataChange:function(r){var a=r.error,i=r.snapshot;e.setState({renderProps:l(a,i,n,t)})},handleRetryAfterError:function(t){e.setState({renderProps:{error:null,props:null,retry:null}})}},n=new o,a=c(this.$props,n,t);return{context:Object.freeze({relay:{environment:a.relayContextEnvironment,variables:a.relayContextVariables}}),state:Object.freeze(r({prevPropsEnvironment:this.$props.environment,prevPropsVariables:this.$props.variables,prevQuery:this.$props.query,queryFetcher:n,retryCallbacks:t},a))}},beforeUpdate:function(){if(this.state.prevQuery!==this.query||this.state.prevPropsEnvironment!==this.environment||!s(this.state.prevPropsVariables,this.variables)){var e=c(this.$props,this.state.queryFetcher,this.state.retryCallbacks);this.context.relay.environment=e.relayContextEnvironment,this.context.relay.variables=e.relayContextVariables,this.setState(r({prevQuery:this.query,prevPropsEnvironment:this.environment,prevPropsVariables:this.variables},e))}},beforeDestroy:function(){this.state.queryFetcher.dispose()},render:function(e){var t=this;return e({name:"relay-context-provider",provide:{relay:this.context.relay},render:function(e){return e("keep-alive",{props:{include:[]}},[t.$scopedSlots.default(t.state.renderProps)])}})},methods:{setState:function(e){this.state=Object.freeze(Object.assign({},this.state,e))}}},h=function(t){return"object"===(void 0===t?"undefined":e(t))&&null!==t&&!Array.isArray(t)&&("object"===(void 0===(r=t.environment)?"undefined":e(r))&&null!==r&&"function"==typeof r.applyMutation&&"function"==typeof r.check&&"function"==typeof r.check&&"function"==typeof r.lookup&&"function"==typeof r.retain&&"function"==typeof r.sendMutation&&"function"==typeof r.sendQuery&&"function"==typeof r.execute&&"function"==typeof r.subscribe)&&("object"===(void 0===(n=t.variables)?"undefined":e(n))&&null!==n&&!Array.isArray(n));var n,r},p=require("fbjs/lib/invariant"),f=require("fbjs/lib/mapObject"),v=function(e,t){return{name:"relay-context-consumer",inject:["relay"],render:function(n){var r=function(e){return p(h(e),"RelayContextConsumer: Expected `relayContext` to be an object conforming to the `RelayContext` interface, got `%s`.",e),e}(this.relay).environment.unstable_internal.getFragment,a=f(e,r),i=this;return n({extends:t.call(this,a),props:Object.keys(a),render:function(e){var t=this,n=function(e){return e("keep-alive",{props:{include:[]}},[i.$scopedSlots.default(Object.assign({relay:t.state.relayProp},t.state.data))])};return this.context?e({name:"relay-context-provider",provide:{relay:this.context.relay},render:n}):n(e)}},{props:this.$attrs})}}},b=require("relay-runtime"),d=b.RelayConcreteNode,y=b.Observable,m=require("fbjs/lib/areEqual"),g=require("fbjs/lib/invariant"),_=require("fbjs/lib/warning"),R=require("fbjs/lib/areEqual"),S=require("relay-runtime"),C=S.ConnectionInterface,P=S.RelayConcreteNode,E=S.Observable,O=function(e){var t=e.count;return g(t,"RelayPaginationContainer: Unable to synthesize a getFragmentVariables function."),function(e,n){return r({},e,(o=n,(i=t)in(a={})?Object.defineProperty(a,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[i]=o,a));var a,i,o}},x=function(e){return"function"==typeof e?{error:e,complete:e,unsubscribe:function(t){"function"==typeof e&&e()}}:e||{}},j=function(t,n){var a=this.relay,i=function(e){var t=null,n=!1;for(var a in e){var i=e[a],o=i.metadata&&i.metadata.connection;void 0!==i.metadata&&(n=!0),o&&(g(1===o.length,"RelayPaginationContainer: Only a single @connection is supported, `%s` has %s.",a,o.length),g(!t,"RelayPaginationContainer: Only a single fragment with @connection is supported."),t=r({},o[0],{fragmentName:a}))}return g(!n||null!==t,"RelayPaginationContainer: A @connection directive must be present."),t||{}}(t),o=n.getConnectionFromProps||function(t){var n=t.path;return g(n,"RelayPaginationContainer: Unable to synthesize a getConnectionFromProps function."),function(r){for(var a=r[t.fragmentName],i=0;i<n.length;i++){if(!a||"object"!==(void 0===a?"undefined":e(a)))return null;a=a[n[i]]}return a}}(i),s=n.direction||i.direction;g(s,"RelayPaginationContainer: Unable to infer direction of the connection, possibly because both first and last are provided.");var l=n.getFragmentVariables||O(i);return{name:"relay-pagination-container",data:function(){var e=(0,a.environment.unstable_internal.createFragmentSpecResolver)(a,this.$options.name,t,this.$props,this._handleFragmentDataUpdate);return{context:Object.freeze({relay:{environment:a.environment,variables:a.variables}}),state:Object.freeze({data:e.resolve(),prevProps:this.$props,relayEnvironment:a.environment,relayVariables:a.variables,relayProp:this._buildRelayProp(a),isARequestInFlight:!1,localVariables:null,refetchSubscription:null,references:[],resolver:e})}},beforeUpdate:function(){var e=a.environment.unstable_internal,n=e.createFragmentSpecResolver,r=e.getDataIDsFromObject,i=r(t,this.state.prevProps),o=r(t,this.$props);if(this.state.relayEnvironment===a.environment&&this.state.relayVariables===a.variables&&R(i,o))this.state.localVariables||this.state.resolver.setProps(this.$props);else{this._release(),this.context.relay.environment=a.environment,this.context.relay.variables=a.variables;var s=n(a,this.$options.name,t,this.$props,this._handleFragmentDataUpdate);this.setState({prevProps:this.$props,relayEnvironment:a.environment,relayVariables:a.variables,relayProp:this._buildRelayProp(a),localVariables:null,resolver:s})}var l=this.state.resolver.resolve();l!==this.state.data&&this.setState({data:l})},beforeDestroy:function(){this._release()},methods:{setState:function(e){this.state=Object.freeze(Object.assign({},this.state,e))},_buildRelayProp:function(e){return{hasMore:this._hasMore,isLoading:this._isLoading,loadMore:this._loadMore,refetchConnection:this._refetchConnection,environment:e.environment}},_handleFragmentDataUpdate:function(){this.setState({data:this.state.resolver.resolve()})},_getConnectionData:function(){var t=r({},this.$props,this.state.data),n=o(t);if(null==n)return null;var a=C.get(),i=a.EDGES,l=a.PAGE_INFO,c=a.HAS_NEXT_PAGE,u=a.HAS_PREV_PAGE,h=a.END_CURSOR,p=a.START_CURSOR;g("object"===(void 0===n?"undefined":e(n)),"RelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return `null` or a plain object with %s and %s properties, got `%s`.",this.$options.name,i,l,n);var f=n[i],v=n[l];if(null==f||null==v)return null;g(Array.isArray(f),"RelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return an object with %s: Array, got `%s`.",this.$options.name,i,f),g("object"===(void 0===v?"undefined":e(v)),"RelayPaginationContainer: Expected `getConnectionFromProps()` in `%s`to return an object with %s: Object, got `%s`.",this.$options.name,l,v);var b="forward"===s?v[c]:v[u],d="forward"===s?v[h]:v[p];return"boolean"!=typeof b||0!==f.length&&void 0===d?(_(!1,"RelayPaginationContainer: Cannot paginate without %s fields in `%s`. Be sure to fetch %s (got `%s`) and %s (got `%s`).",l,this.$options.name,"forward"===s?c:u,b,"forward"===s?h:p,d),null):{cursor:d,edgeCount:f.length,hasMore:b}},_hasMore:function(){var e=this._getConnectionData();return!!(e&&e.hasMore&&e.cursor)},_isLoading:function(){return!!this.state.refetchSubscription},_refetchConnection:function(e,t,n){var r={count:e,cursor:null,totalCount:e};return{dispose:this._fetchPage(r,x(t),{force:!0},n).unsubscribe}},_loadMore:function(e,t,n){var r=x(t),a=this._getConnectionData();if(!a)return E.create(function(e){return e.complete()}).subscribe(r),null;var i=a.edgeCount+e;if(n&&n.force)return this._refetchConnection(i,t);var o=C.get(),l=o.END_CURSOR,c=o.START_CURSOR,u=a.cursor;_(u,"RelayPaginationContainer: Cannot `loadMore` without valid `%s` (got `%s`)","forward"===s?l:c,u);var h={count:e,cursor:u,totalCount:i};return{dispose:this._fetchPage(h,r,n).unsubscribe}},_fetchPage:function(i,o,s,c){var u=this,h=a.environment,p=h.unstable_internal,f=p.createOperationSelector,v=p.getRequest,b=p.getVariablesFromObject,d=r({},this.$props,this.state.data),y=b(this.context.relay.variables,t,this.$props);y=r({},y,c);var m=n.getVariables(d,{count:i.count,cursor:i.cursor},y);g("object"===(void 0===m?"undefined":e(m))&&null!==m,"RelayPaginationContainer: Expected `getVariables()` to return an object, got `%s` in `%s`.",m,this.$options.name),m=r({},m,c),this.setState({localVariables:m});var _=s?{force:!!s.force}:void 0;_&&s&&s.rerunParamExperimental&&(_.rerunParamExperimental=s.rerunParamExperimental);var S=v(n.query);if(S.kind===P.BATCH_REQUEST)throw new Error("RelayPaginationContainer: Batch request not yet implemented (T22954884)");var C=f(S,m),O=h.retain(C.root);this.state.references.push(O),this.state.refetchSubscription&&this.state.refetchSubscription.unsubscribe();var x=function(){u.state.refetchSubscription===j&&(u.state.refetchSubscription.unsubscribe(),u.setState({refetchSubscription:null,isARequestInFlight:!1}))};this.setState({isARequestInFlight:!0});var j=h.execute({operation:C,cacheConfig:_}).mergeMap(function(e){return E.create(function(e){!function(e,t){u.context.relay.environment=a.environment,u.context.relay.variables=r({},a.variables,y);var n=u.state.resolver.resolve();u.state.resolver.setVariables(l(y,i.totalCount));var o=u.state.resolver.resolve();R(n,o)||u.setState({data:o}),t()}(0,function(){e.next(),e.complete()})})}).do({error:x,complete:x,unsubscribe:x}).subscribe(o||{});return this.setState({refetchSubscription:this.state.isARequestInFlight?j:null}),j},_release:function(){this.state.resolver.dispose(),this.state.references.forEach(function(e){return e.dispose()}),this.state.references.length=0,this.state.refetchSubscription&&(this.state.refetchSubscription.unsubscribe(),this.setState({refetchSubscription:null,isARequestInFlight:!1}))}}}},F=require("fbjs/lib/areEqual"),q=function(e){var t=this.relay;return{name:"relay-fragment-container",data:function(){var n=(0,t.environment.unstable_internal.createFragmentSpecResolver)(t,this.$options.name,e,this.$props,this._handleFragmentDataUpdate);return{state:Object.freeze({data:n.resolve(),prevProps:this.$props,relayEnvironment:t.environment,relayVariables:t.variables,relayProp:{isLoading:n.isLoading(),environment:t.environment},resolver:n})}},beforeUpdate:function(){var n=t.environment.unstable_internal,r=n.createFragmentSpecResolver,a=n.getDataIDsFromObject,i=a(e,this.state.prevProps),o=a(e,this.$props),s=this.state.resolver;if(this.state.relayEnvironment===t.environment&&this.state.relayVariables===t.variables&&F(i,o)){s.setProps(this.$props);var l=s.resolve();l!==this.state.data&&this.setState({data:l,prevProps:this.$props,relayEnvironment:t.environment,relayVariables:t.variables,relayProp:{isLoading:s.isLoading(),environment:t.environment}})}else s.dispose(),s=r(t,this.$options.name,e,this.$props,this._handleFragmentDataUpdate),this.setState({data:s.resolve(),prevProps:this.$props,relayEnvironment:t.environment,relayVariables:t.variables,relayProp:{isLoading:s.isLoading(),environment:t.environment},resolver:s})},beforeDestroy:function(){this.state.resolver.dispose()},methods:{setState:function(e){this.state=Object.freeze(Object.assign({},this.state,e))},_handleFragmentDataUpdate:function(){this.setState({data:this.state.resolver.resolve(),relayProp:{isLoading:this.state.resolver.isLoading(),environment:this.state.relayProp.environment}})}}}},$=require("relay-runtime");return{QueryRenderer:u,MutationTypes:$.MutationTypes,RangeOperations:$.RangeOperations,commitLocalUpdate:$.commitLocalUpdate,commitMutation:$.commitMutation,createRefetchContainer:function(e,t){return v(e,function(e){return function(e,t){var n=this.relay;return{name:"relay-refetch-container",data:function(){var t=(0,n.environment.unstable_internal.createFragmentSpecResolver)(n,this.$options.name,e,this.$props,this._handleFragmentDataUpdate);return{context:Object.freeze({relay:{environment:n.environment,variables:n.variables}}),state:Object.freeze({data:t.resolve(),prevProps:this.$props,relayEnvironment:n.environment,relayVariables:n.variables,relayProp:this._buildRelayProp(n),localVariables:null,refetchSubscription:null,references:[],resolver:t})}},beforeUpdate:function(){var t=n.environment.unstable_internal,r=t.createFragmentSpecResolver,a=t.getDataIDsFromObject,i=a(e,this.state.prevProps),o=a(e,this.$props);if(this.state.relayEnvironment===n.environment&&this.state.relayVariables===n.variables&&m(i,o))this.state.localVariables||this.state.resolver.setProps(this.$props);else{this._release(),this.context.relay.environment=n.environment,this.context.relay.variables=n.variables;var s=r(n,this.$options.name,e,this.$props,this._handleFragmentDataUpdate);this.setState({prevProps:this.$props,relayEnvironment:n.environment,relayVariables:n.variables,relayProp:this._buildRelayProp(n),localVariables:null,resolver:s})}var l=this.state.resolver.resolve();l!==this.state.data&&this.setState({data:l})},beforeDestroy:function(){this._release()},methods:{setState:function(e){this.state=Object.freeze(Object.assign({},this.state,e))},_buildRelayProp:function(e){return{environment:e.environment,refetch:this._refetch}},_handleFragmentDataUpdate:function(){this.setState({data:this.state.resolver.resolve()})},_getFragmentVariables:function(){return(0,n.environment.unstable_internal.getVariablesFromObject)(n.variables,e,this.$props)},_refetch:function(e,a,i,o){var s=this,l=n.environment,c=n.variables,u=l.unstable_internal,h=u.createOperationSelector,p=u.getRequest,f="function"==typeof e?e(this._getFragmentVariables()):e;f=r({},c,f);var v=a?r({},c,a):f;this.setState({localVariables:f});var b=o?{force:!!o.force}:void 0,m="function"==typeof i?{next:i,error:i}:i||{},g=p(t);if(g.kind===d.BATCH_REQUEST)throw new Error("RelayRefetchContainer: Batch request not yet implemented (T22955000)");var _=h(g,f),R=l.retain(_.root);this.state.references.push(R),this.state.refetchSubscription&&this.state.refetchSubscription.unsubscribe();var S=void 0;return l.execute({operation:_,cacheConfig:b}).mergeMap(function(e){return s.context.relay.environment=n.environment,s.context.relay.variables=v,s.state.resolver.setVariables(v),y.create(function(e){s.setState({data:s.state.resolver.resolve()}),e.next(),e.complete()})}).finally(function(){s.state.refetchSubscription===S&&(s.state.refetchSubscription.unsubscribe(),s.setState({refetchSubscription:null}))}).subscribe(r({},m,{start:function(e){S=e,s.setState({refetchSubscription:e}),m.start&&m.start(e)}})),{dispose:function(){S&&S.unsubscribe()}}}}}}.call(this,e,t)})},createPaginationContainer:function(e,t){return v(e,function(e){return j.call(this,e,t)})},createFragmentContainer:function(e){return v(e,q)},fetchQuery:$.fetchQuery,graphql:$.graphql,requestSubscription:$.requestSubscription}});
